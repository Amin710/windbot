# پنل وب مدیریت ربات ویندسکرایب

یک پنل وب مدیریتی کامل برای مدیریت ربات فروش ویندسکرایب با استفاده از Flask.

## ویژگی‌ها

### 📊 داشبورد
- ✅ نمایش آمار کلی سیستم (کاربران، سفارشات، اکانت‌ها)
- ✅ نمودارهای آماری و روند فروش
- ✅ آخرین سفارشات و فعالیت‌ها
- ✅ دسترسی سریع به عملیات مهم
- ✅ بروزرسانی خودکار هر 30 ثانیه

### 👥 مدیریت اکانت‌ها
- ✅ مشاهده لیست کامل اکانت‌های ویندسکرایب
- ✅ افزودن اکانت جدید با رمزگذاری امن
- ✅ مشاهده جزئیات هر اکانت (ایمیل، رمز، 2FA)
- ✅ کپی آسان اطلاعات حساس
- ✅ آمار استفاده هر اکانت (نمودار پیشرفت)
- ✅ نمایش تعداد صندلی‌های استفاده شده و موجود
- 🔄 ویرایش و حذف اکانت‌ها (API آماده، UI در حال توسعه)

### 🛒 مدیریت سفارشات
- ✅ مشاهده تمام سفارشات با فیلتر وضعیت
- ✅ جزئیات کامل هر سفارش در مودال
- ✅ تایید و رد سفارشات از پنل وب
- ✅ فیلتر پیشرفته بر اساس وضعیت (در انتظار، تایید شده، رد شده)
- ✅ نمایش اطلاعات کاربر در هر سفارش
- ✅ تاریخ ایجاد و تایید سفارشات

### 👤 مدیریت کاربران
- ✅ لیست کامل کاربران ربات
- ✅ اطلاعات تماس (تلگرام ID، نام کاربری)
- ✅ آمار سفارشات هر کاربر
- ✅ تاریخ عضویت و فعالیت
- 🔄 ارسال پیام مستقیم به کاربران (API آماده)
- 🔄 مسدود کردن و آزاد سازی کاربران (در حال توسعه)

### 💳 مدیریت کارت‌ها
- ✅ لیست شماره کارت‌های فعال
- ✅ افزودن و ویرایش شماره کارت‌ها
- ✅ حذف کارت‌های غیرضروری
- ✅ کپی آسان شماره کارت‌ها
- ✅ اعتبارسنجی شماره کارت ایرانی
- ✅ فرمت خودکار شماره کارت

### 🔐 امنیت
- ✅ سیستم احراز هویت با username/password
- ✅ جلسات امن Flask-Login
- ✅ رمزگذاری اطلاعات حساس
- ✅ حفاظت از CSRF
- ✅ ضدعفونی ورودی‌ها (XSS Prevention)

## نصب و راه‌اندازی

### پیش‌نیازها

```bash
Python 3.8+
PostgreSQL
```

### 1. نصب پکیج‌ها

```bash
cd web_admin
pip install -r requirements.txt
```

### 2. تنظیم متغیرهای محیطی

در فایل `.env` در پوشه اصلی پروژه:

```env
# Flask Configuration
FLASK_SECRET_KEY=your-very-secret-key-here
FLASK_DEBUG=True
FLASK_HOST=0.0.0.0
FLASK_PORT=5000

# Database (همان تنظیمات ربات)
DB_URI=postgresql://winduser:yourpassword@localhost:5432/wind_reseller
FERNET_KEY=your-fernet-key-from-bot

# Admin Panel
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your-admin-password

# Bot Integration (اختیاری)
BOT_TOKEN=your-bot-token
RECEIPT_CHANNEL_ID=your-receipt-channel-id
LOG_SELL_CHID=your-sales-log-channel-id
```

### 3. راه‌اندازی پایگاه داده

پنل وب از همان پایگاه داده ربات استفاده می‌کند. تنها نیاز است جدول مدیران اضافه شود (خودکار انجام می‌شود).

### 4. اجرای پنل

```bash
# روش ساده
cd web_admin
python run.py

# یا روش مستقیم
python app.py
```

پنل در آدرس http://localhost:5000 در دسترس خواهد بود.

### اطلاعات ورود پیش‌فرض

- **نام کاربری:** admin
- **رمز عبور:** admin123

⚠️ **مهم:** حتماً رمز عبور پیش‌فرض را تغییر دهید!

## استفاده

### مدیریت اکانت‌ها

1. از منوی چپ "اکانت‌های ویندسکرایب" را انتخاب کنید
2. روی "افزودن اکانت جدید" کلیک کنید
3. اطلاعات زیر را وارد کنید:
   - آدرس ایمیل اکانت ویندسکرایب
   - رمز عبور اکانت
   - کد 2FA (Secret) - از تنظیمات امنیت ویندسکرایب
   - تعداد صندلی (معمولاً 15)

### مدیریت سفارشات

1. وارد بخش "سفارشات" شوید
2. از فیلترهای بالا وضعیت مورد نظر را انتخاب کنید
3. برای تایید یا رد سفارش از دکمه‌های مربوطه استفاده کنید
4. برای مشاهده جزئیات روی آیکون چشم کلیک کنید

### مدیریت کارت‌ها

1. وارد بخش "شماره کارت‌ها" شوید
2. روی "افزودن کارت جدید" کلیک کنید
3. شماره کارت 16 رقمی را وارد کنید
4. برای کپی شماره کارت از آیکون کپی استفاده کنید

## API Endpoints

پنل دارای API کاملی برای عملیات‌های زیر است:

### سفارشات
- `GET /api/orders/<id>` - جزئیات سفارش
- `POST /api/orders/<id>/approve` - تایید سفارش  
- `POST /api/orders/<id>/reject` - رد سفارش

### کارت‌ها
- `POST /api/cards` - افزودن کارت جدید
- `PUT /api/cards/<id>` - ویرایش کارت
- `DELETE /api/cards/<id>` - حذف کارت

### پیام‌رسانی
- `POST /api/send-message` - ارسال پیام به کاربر

### آمار
- `GET /api/stats` - آمار داشبورد

## Architecture

### ساختار فایل‌ها

```
web_admin/
├── app.py              # اپلیکیشن اصلی Flask
├── run.py              # اسکریپت راه‌اندازی
├── config.py           # تنظیمات و کانفیگ
├── requirements.txt    # وابستگی‌های Python
├── templates/          # قالب‌های HTML
│   ├── base.html       # قالب پایه RTL
│   ├── login.html      # صفحه ورود
│   ├── dashboard.html  # داشبورد اصلی
│   ├── seats.html      # لیست اکانت‌ها
│   ├── add_seat.html   # افزودن اکانت
│   ├── view_seat.html  # جزئیات اکانت
│   ├── orders.html     # مدیریت سفارشات
│   ├── users.html      # لیست کاربران
│   └── cards.html      # مدیریت کارت‌ها
├── utils/              # توابع کمکی
│   ├── __init__.py
│   └── helpers.py      # توابع کمکی
└── README.md           # مستندات
```

### تکنولوژی‌های استفاده شده

- **Backend:** Flask (Python)
- **Frontend:** Bootstrap 5 RTL + Font Awesome + Chart.js
- **Database:** PostgreSQL
- **Authentication:** Flask-Login
- **Security:** Werkzeug Password Hashing + Fernet Encryption
- **UI/UX:** Responsive design با پشتیبانی کامل RTL

## امنیت

### اقدامات امنیتی اعمال شده

1. **رمزگذاری رمزهای عبور:** با bcrypt
2. **رمزگذاری اطلاعات حساس:** با Fernet (همان سیستم ربات)
3. **محافظت از جلسات:** Flask-Login
4. **اعتبارسنجی ورودی:** سمت سرور و کلاینت
5. **حفاظت از XSS:** Sanitization
6. **HTTPS:** قابل تنظیم برای پروداکشن

### توصیه‌های امنیتی

1. حتماً رمز عبور پیش‌فرض را تغییر دهید
2. از HTTPS استفاده کنید
3. دسترسی به پنل را محدود کنید (VPN/IP whitelist)
4. از فایروال استفاده کنید
5. نسخه‌های پشتیبان منظم بگیرید

## ویژگی‌های تکمیل شده ✅

- [x] سیستم احراز هویت کامل
- [x] داشبورد با آمار زنده
- [x] مدیریت کامل اکانت‌ها (افزودن، مشاهده)
- [x] مدیریت کامل سفارشات (فیلتر، تایید، رد)
- [x] مدیریت کامل کارت‌ها (CRUD)
- [x] رابط کاربری RTL کامل
- [x] API endpoints کامل
- [x] اعتبارسنجی داده‌ها
- [x] رمزگذاری اطلاعات حساس
- [x] توابع کمکی و utilities

## ویژگی‌های در حال توسعه 🚧

- [ ] ادغام کامل با ربات برای ارسال پیام
- [ ] ویرایش اکانت‌ها از UI
- [ ] سیستم نقش‌های کاربری (مدیر، ناظر، ...)
- [ ] گزارش‌گیری پیشرفته و نمودارها
- [ ] سیستم نوتیفیکیشن
- [ ] تنظیمات پیشرفته ربات از پنل
- [ ] ارسال پیام انبوه
- [ ] سیستم تیکت و پشتیبانی

## مشارکت

برای مشارکت در توسعه:

1. کد را Fork کنید
2. برنچ جدید بسازید (`git checkout -b feature/AmazingFeature`)
3. تغییرات را commit کنید (`git commit -m 'Add some AmazingFeature'`)
4. Push کنید (`git push origin feature/AmazingFeature`)
5. Pull Request ارسال کنید

## پشتیبانی

در صورت وجود مشکل یا سوال:

1. ابتدا مستندات و INSTALL.md را مطالعه کنید
2. لاگ‌های سیستم را بررسی کنید
3. Issue جدید در GitHub ایجاد کنید

---

**نکته:** این پنل به عنوان مکمل ربات تلگرام طراحی شده و نیاز به ربات اصلی برای عملکرد کامل دارد. 